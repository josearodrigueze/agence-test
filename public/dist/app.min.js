"use strict";var app=angular.module("app",["ui.router","ui.bootstrap","frapontillo.bootstrap-duallistbox","ngResource","ngNumeraljs","chart.js"]);app.factory("appConfig",[function(){var e=!1,o="josearodrigueze.com.ve/agence",r=o+"/backend/public";return{getPathApi:function(){var o="http://";return e&&(o="https://"),"/"!=r.substring(r.length-1,r.length)&&(r+="/"),o+r}}}]),app.directive("templateMessages",["$rootScope","$compile",function(e,o){return{replace:!0,restrict:"E",templateUrl:"modules/views/messages.html",link:function(r,t,a,n){e.$watch("type",function(a){if(a){var n;$(t).find(".content-messages-alert").remove(),"info"==a&&(n=angular.element('<div class="content-messages-alert" ><span class="glyphicon glyphicon-info-sign"></span>&nbsp;&nbsp;'+e.flash_info+"</div>")),"error"==a&&(n=angular.element('<div class="content-messages-alert" ><span class="glyphicon glyphicon-warning-sign"></span>&nbsp;&nbsp;'+e.flash_error+"</div>")),"success"==a&&(n=angular.element('<div class="content-messages-alert" ><span class="glyphicon glyphicon-ok-sign"></span>&nbsp;&nbsp;'+e.flash_success+"</div>"));var s=o(n)(r);angular.element("#content-alert").css("z-index","1000"),angular.element("#template-"+a).append(s)}})}}}]),app.factory("flashMessages",["$rootScope","$timeout",function(e,o){var r=3500,t=50,a=function(){e.flash_success="",e.flash_error="",e.flash_info="",e.type="",angular.element("#content-alert").css("z-index","-2")},n=function(){angular.element("#content-alert").css("z-index","100000")};return e.closeAlert=function(){e.flash_success="",e.flash_error="",e.flash_info="",e.type=""},{show_success:function(s){e.flash_success=s,e.type="success",o(function(){a()},r),o(function(){n()},t)},show_error:function(s){e.flash_error=s,e.type="error",o(function(){a()},r),o(function(){n()},t)},show_info:function(s){e.flash_info=s,e.type="info",o(function(){a()},r),o(function(){n()},t)},clear:function(){a()}}}]),app.config(["$injector",function(e){var o=e.get("$stateProvider","app.config"),r=e.get("$urlRouterProvider","app.config"),t=e.get("REPORTE","app.config");r.otherwise("/admin");for(var a=t,n=0,s=a.length;s>n;n++)o.state(a[n].state,a[n].config)}]).run(["$rootScope",function(e){e.$on("$stateChangeError",console.log.bind(console))}]),app.constant("REPORTE",[{state:"admin",config:{url:"/admin",templateUrl:"modules/views/filtros.html",controller:"filtrosController",resolve:{rSalesMen:["servicesModel",function(e){return e.vendedores().$promise}]}}},{state:"admin.relatorio",config:{url:"/relatorio/:filtros",templateUrl:"modules/views/relatorio.html",controller:"RelatorioController",resolve:{rVentas:["$stateParams","servicesModel",function(e,o){var r=angular.fromJson(e.filtros);return o.relatorio(r).$promise}]}}},{state:"admin.grafico",config:{url:"/grafico/:filtros",templateUrl:"modules/views/graficos.html?v=1.1",controller:"GraficoController",resolve:{rVentas:["$stateParams","servicesModel",function(e,o){var r=angular.fromJson(e.filtros);return o.grafico(r).$promise}]}}},{state:"admin.pizza",config:{url:"/pizza/:filtros",templateUrl:"modules/views/pizza.html?v=1.1",controller:"PizzaController",resolve:{rVentas:["$stateParams","servicesModel",function(e,o){var r=angular.fromJson(e.filtros);return o.pizza(r).$promise}]}}}]),app.controller("filtrosController",["$injector","$scope","rSalesMen",function(e,o,r){function t(){var r=!0;return o.model.vendedores.length||(r=!1,e.get("flashMessages","esVAlido").show_error("Debe indicar un Vendedor!!")),r}function a(){return{filtros:angular.toJson(o.model)}}o.model={desde:null,hasta:null,vendedores:[]};var n=e.get("$stateParams","filtrosController").filtros;angular.isUndefined(n)||(n=angular.fromJson(n),o.model.vendedores=n.vendedores,o.model.desde=n.desde,o.model.hasta=n.hasta),o.dualbox={salesmen:r,settings:{bootstrap2:!1,filterClear:"Ver Todos!",filterPlaceHolder:"Filtro!",moveSelectedLabel:"Mover solo seleccionado",moveAllLabel:"Mover Todos!",removeSelectedLabel:"Remove selected only",removeAllLabel:"Eliminar Todos!",moveOnSelect:!0,preserveSelection:"Movido",selectedListLabel:"Seleccionados",nonSelectedListLabel:"No Seleccionados",postfix:"_helperz",selectMinHeight:130,filter:!0,filterNonSelected:"",filterSelected:"",infoAll:"Ver Todos {0}!",infoFiltered:'<span class="label label-warning">Filtrados</span> {0} de {1}!',infoEmpty:"Lista Vacia!",filterValues:!0}},o.calendar={opened:{start:!1,end:!1},format:"MMMM/yyyy",minDate:"01-01-1950",maxDate:"01-01-2100",dateOptions:{startingDay:1,showWeeks:!1,datepickerMode:"month",minMode:"month"},open:function(e,r){e.preventDefault(),e.stopPropagation(),angular.forEach(o.calendar.opened,function(e,r){o.calendar.opened[r]=!1}),o.calendar.opened[r]=!0},disabled:function(e,o){return"day"===o&&(0===e.getDay()||6===e.getDay())}},o.buttons={relatorio:function(){if(t()){var o=e.get("$state","button.relatior");o.go("admin.relatorio",a(),{reload:!0})}},grafico:function(){if(t()){var o=e.get("$state","button.grafico");o.go("admin.grafico",a(),{reload:!0})}},pizza:function(){if(t()){var o=e.get("$state","button.pizza");o.go("admin.pizza",a(),{reload:!0})}}}}]),app.controller("GraficoController",["$injector","$scope","rVentas",function(e,o,r){o.grafico={series:[],labels:[],data:[]};var t,a,n=null,s={},l=o.grafico,i=o.model.vendedores;for(t=0,a=r.length;a>t;t++){n=r[t].data,l.labels.push(r[t].date);for(var c=0,u=i.length;u>c;c++){angular.isUndefined(s[i[c].co_usuario])&&(s[i[c].co_usuario]=[]);for(var f=0,p=n.length;p>f;f++)i[c].co_usuario==n[f].co_usuario&&s[i[c].co_usuario].push(n[f].liquida)}}for(t=0,a=i.length;a>t;t++){var d=i[t];l.data.push(s[d.co_usuario]),l.series.push(d.no_usuario)}}]),app.controller("PizzaController",["$scope","rVentas",function(e,o){e.grafico={labels:[],data:[]};for(var r=0,t=o.length;t>r;r++)e.grafico.labels.push(o[r].no_usuario),e.grafico.data.push(o[r].liquida)}]),app.controller("RelatorioController",["$injector","$scope","rVentas",function(e,o,r){o.relatorios=r,o.getTotalLiquido=function(e){for(var o=0,r=e.length-1;r>=0;r--)o+=parseFloat(e[r].liquida);return o},o.getTotalCosto=function(e){for(var o=0,r=e.length-1;r>=0;r--)o+=parseFloat(e[r].costo);return o},o.getTotalComision=function(e){for(var o=0,r=e.length-1;r>=0;r--)o+=parseFloat(e[r].comision);return o},o.getTotalLucro=function(e){for(var o=0,r=e.length-1;r>=0;r--)o+=parseFloat(e[r].liquida)-parseFloat(e[r].comision)-parseFloat(e[r].costo);return o}}]),app.directive("calcular-lucro",[function(){return{restrict:"E",template:'<span class="{{class}}">{{signo}}R$ {{result}}</span>',link:function(e,o,r){e.result=r.params.liquida-r.params.costo-r.params.comision,e["class"]="positivo",e.signo="",e.result<0&&(e["class"]="negativo",e.signo="-")}}}]),app.factory("servicesModel",["$resource","appConfig",function(e,o){var r=o.getPathApi()+"importaciones/peticiones/:id";return e(r,{id:"@_id"},{vendedores:{method:"GET",url:o.getPathApi()+"vendedores",isArray:!0},relatorio:{method:"POST",url:o.getPathApi()+"relatorio",isArray:!0},grafico:{method:"POST",url:o.getPathApi()+"grafico",isArray:!0},pizza:{method:"POST",url:o.getPathApi()+"pizza",isArray:!0}})}]);